<div class="orders-container">
  <h2>📦 Admin - Upravljanje porudžbinama</h2>

  <!-- Sortiranje -->
  <mat-form-field appearance="fill">
    <mat-label>Sortiraj po</mat-label>
    <mat-select [(value)]="sort" (selectionChange)="loadOrders()">
      <mat-option value="id,asc">ID (rastuće)</mat-option>
      <mat-option value="id,desc">ID (opadajuće)</mat-option>
      <mat-option value="totalPrice,asc">Cena (rastuće)</mat-option>
      <mat-option value="totalPrice,desc">Cena (opadajuće)</mat-option>
    </mat-select>
  </mat-form-field>

  <table class="orders-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Korisnik</th>
        <th>Ukupna cena</th>
        <th>Status</th>
        <th>Akcije</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let o of orders">
        <td>{{ o.id }}</td>
        <td>{{ o.user.name }} {{ o.user.surname }}</td>
        <td class="price">{{ o.totalPrice | currency:'EUR' }}</td>
        <td>
          <ng-container *ngIf="editingOrder?.id === o.id; else viewMode">
            <form *ngIf="statusForm" [formGroup]="statusForm" (ngSubmit)="saveStatus()" class="status-form">
              <input formControlName="status" />
              <button type="submit" class="btn save">Sačuvaj</button>
              <button type="button" (click)="cancelEdit()" class="btn cancel">Otkaži</button>
            </form>
          </ng-container>
          <ng-template #viewMode>
            <span class="status">{{ o.status }}</span>
          </ng-template>
        </td>
        <td class="actions">
          <button (click)="startEdit(o)" class="btn edit">✏️ Izmeni status</button>
          <button (click)="deleteOrder(o.id!)" class="btn delete">🗑️ Otkaži</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Paginacija -->
  <mat-paginator
    [length]="totalElements"
    [pageSize]="pageSize"
    [pageSizeOptions]="[5, 10, 20]"
    (page)="changePage($event)">
  </mat-paginator>
</div>
